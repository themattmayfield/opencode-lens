{"version":3,"file":"useFileDiffInstance.js","names":["deepEqual"],"sources":["../../../src/react/utils/useFileDiffInstance.ts"],"sourcesContent":["import deepEqual from 'fast-deep-equal';\nimport { useEffect, useLayoutEffect, useRef } from 'react';\n\nimport { FileDiff, type FileDiffOptions } from '../../FileDiff';\nimport type {\n  DiffLineAnnotation,\n  FileContents,\n  FileDiffMetadata,\n} from '../../types';\nimport { useStableCallback } from './useStableCallback';\n\nconst useIsometricEffect =\n  typeof window === 'undefined' ? useEffect : useLayoutEffect;\n\ninterface UseFileDiffInstanceProps<LAnnotation> {\n  oldFile?: FileContents;\n  newFile?: FileContents;\n  fileDiff?: FileDiffMetadata;\n  options?: FileDiffOptions<LAnnotation>;\n  lineAnnotations?: DiffLineAnnotation<LAnnotation>[];\n}\n\nexport function useFileDiffInstance<LAnnotation>({\n  oldFile,\n  newFile,\n  fileDiff,\n  options,\n  lineAnnotations,\n}: UseFileDiffInstanceProps<LAnnotation>): (\n  fileContainer: HTMLElement | null\n) => void {\n  const instanceRef = useRef<FileDiff<LAnnotation> | null>(null);\n  const ref = useStableCallback((fileContainer: HTMLElement | null) => {\n    if (fileContainer != null) {\n      if (instanceRef.current != null) {\n        throw new Error(\n          'useFileDiffInstance: An instance should not already exist when a node is created'\n        );\n      }\n      // FIXME: Ideally we don't use FileDiffUI here, and instead amalgamate\n      // the renderers manually\n      instanceRef.current = new FileDiff(options, true);\n      void instanceRef.current.hydrate({\n        fileDiff,\n        oldFile,\n        newFile,\n        fileContainer,\n        lineAnnotations,\n      });\n    } else {\n      if (instanceRef.current == null) {\n        throw new Error(\n          'useFileDiffInstance: A FileDiff instance should exist when unmounting'\n        );\n      }\n      instanceRef.current.cleanUp();\n      instanceRef.current = null;\n    }\n  });\n\n  useIsometricEffect(() => {\n    if (instanceRef.current == null) return;\n    const forceRender = !deepEqual(instanceRef.current.options, options);\n    instanceRef.current.setOptions(options);\n    void instanceRef.current.render({\n      forceRender,\n      fileDiff,\n      oldFile,\n      newFile,\n      lineAnnotations: lineAnnotations,\n    });\n  });\n  return ref;\n}\n"],"mappings":";;;;;;AAWA,MAAM,qBACJ,OAAO,WAAW,cAAc,YAAY;AAU9C,SAAgB,oBAAiC,EAC/C,SACA,SACA,UACA,SACA,mBAGQ;CACR,MAAM,cAAc,OAAqC,KAAK;CAC9D,MAAM,MAAM,mBAAmB,kBAAsC;AACnE,MAAI,iBAAiB,MAAM;AACzB,OAAI,YAAY,WAAW,KACzB,OAAM,IAAI,MACR,mFACD;AAIH,eAAY,UAAU,IAAI,SAAS,SAAS,KAAK;AACjD,GAAK,YAAY,QAAQ,QAAQ;IAC/B;IACA;IACA;IACA;IACA;IACD,CAAC;SACG;AACL,OAAI,YAAY,WAAW,KACzB,OAAM,IAAI,MACR,wEACD;AAEH,eAAY,QAAQ,SAAS;AAC7B,eAAY,UAAU;;GAExB;AAEF,0BAAyB;AACvB,MAAI,YAAY,WAAW,KAAM;EACjC,MAAM,cAAc,CAACA,WAAU,YAAY,QAAQ,SAAS,QAAQ;AACpE,cAAY,QAAQ,WAAW,QAAQ;AACvC,EAAK,YAAY,QAAQ,OAAO;GAC9B;GACA;GACA;GACA;GACiB;GAClB,CAAC;GACF;AACF,QAAO"}