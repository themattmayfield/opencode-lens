{"version":3,"file":"useFileInstance.js","names":["deepEqual"],"sources":["../../../src/react/utils/useFileInstance.ts"],"sourcesContent":["import deepEqual from 'fast-deep-equal';\nimport { useEffect, useLayoutEffect, useRef } from 'react';\n\nimport { File, type FileOptions } from '../../File';\nimport type { FileContents, LineAnnotation } from '../../types';\nimport { useStableCallback } from './useStableCallback';\n\nconst useIsometricEffect =\n  typeof window === 'undefined' ? useEffect : useLayoutEffect;\n\ninterface UseFileInstanceProps<LAnnotation> {\n  file: FileContents;\n  options?: FileOptions<LAnnotation>;\n  lineAnnotations?: LineAnnotation<LAnnotation>[];\n}\nexport function useFileInstance<LAnnotation>({\n  file,\n  options,\n  lineAnnotations,\n}: UseFileInstanceProps<LAnnotation>): (node: HTMLElement | null) => void {\n  const instanceRef = useRef<File<LAnnotation> | null>(null);\n  const ref = useStableCallback((node: HTMLElement | null) => {\n    if (node != null) {\n      if (instanceRef.current != null) {\n        throw new Error(\n          'File: An instance should not already exist when a node is created'\n        );\n      }\n      // FIXME: Ideally we don't use FileUI here, and instead amalgamate\n      // the renderers manually\n      instanceRef.current = new File(options, true);\n      void instanceRef.current.hydrate({\n        file,\n        fileContainer: node,\n        lineAnnotations,\n      });\n    } else {\n      if (instanceRef.current == null) {\n        throw new Error('File: A File instance should exist when unmounting');\n      }\n      instanceRef.current.cleanUp();\n      instanceRef.current = null;\n    }\n  });\n\n  useIsometricEffect(() => {\n    if (instanceRef.current == null) return;\n    const forceRender = !deepEqual(instanceRef.current.options, options);\n    instanceRef.current.setOptions(options);\n    void instanceRef.current.render({\n      file,\n      lineAnnotations,\n      forceRender,\n    });\n  });\n  return ref;\n}\n"],"mappings":";;;;;;AAOA,MAAM,qBACJ,OAAO,WAAW,cAAc,YAAY;AAO9C,SAAgB,gBAA6B,EAC3C,MACA,SACA,mBACwE;CACxE,MAAM,cAAc,OAAiC,KAAK;CAC1D,MAAM,MAAM,mBAAmB,SAA6B;AAC1D,MAAI,QAAQ,MAAM;AAChB,OAAI,YAAY,WAAW,KACzB,OAAM,IAAI,MACR,oEACD;AAIH,eAAY,UAAU,IAAI,KAAK,SAAS,KAAK;AAC7C,GAAK,YAAY,QAAQ,QAAQ;IAC/B;IACA,eAAe;IACf;IACD,CAAC;SACG;AACL,OAAI,YAAY,WAAW,KACzB,OAAM,IAAI,MAAM,qDAAqD;AAEvE,eAAY,QAAQ,SAAS;AAC7B,eAAY,UAAU;;GAExB;AAEF,0BAAyB;AACvB,MAAI,YAAY,WAAW,KAAM;EACjC,MAAM,cAAc,CAACA,WAAU,YAAY,QAAQ,SAAS,QAAQ;AACpE,cAAY,QAAQ,WAAW,QAAQ;AACvC,EAAK,YAAY,QAAQ,OAAO;GAC9B;GACA;GACA;GACD,CAAC;GACF;AACF,QAAO"}