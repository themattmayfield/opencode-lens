import { FileDiff } from "../../FileDiff.js";
import { useStableCallback } from "./useStableCallback.js";
import deepEquals from "fast-deep-equal";
import { useEffect, useLayoutEffect, useRef } from "react";

//#region src/react/utils/useFileDiffInstance.ts
const useIsometricEffect = typeof window === "undefined" ? useEffect : useLayoutEffect;
function useFileDiffInstance({ oldFile, newFile, fileDiff, options, lineAnnotations }) {
	const instanceRef = useRef(null);
	const ref = useStableCallback((fileContainer) => {
		if (fileContainer != null) {
			if (instanceRef.current != null) throw new Error("useFileDiffInstance: An instance should not already exist when a node is created");
			instanceRef.current = new FileDiff(options, true);
			instanceRef.current.hydrate({
				fileDiff,
				oldFile,
				newFile,
				fileContainer,
				lineAnnotations
			});
		} else {
			if (instanceRef.current == null) throw new Error("useFileDiffInstance: A FileDiff instance should exist when unmounting");
			instanceRef.current.cleanUp();
			instanceRef.current = null;
		}
	});
	useIsometricEffect(() => {
		if (instanceRef.current == null) return;
		const forceRender = !deepEquals(instanceRef.current.options, options);
		instanceRef.current.setOptions(options);
		instanceRef.current.render({
			forceRender,
			fileDiff,
			oldFile,
			newFile,
			lineAnnotations
		});
	});
	return ref;
}

//#endregion
export { useFileDiffInstance };
//# sourceMappingURL=useFileDiffInstance.js.map