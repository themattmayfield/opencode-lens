import { File } from "../../File.js";
import { useStableCallback } from "./useStableCallback.js";
import deepEquals from "fast-deep-equal";
import { useEffect, useLayoutEffect, useRef } from "react";

//#region src/react/utils/useFileInstance.ts
const useIsometricEffect = typeof window === "undefined" ? useEffect : useLayoutEffect;
function useFileInstance({ file, options, lineAnnotations }) {
	const instanceRef = useRef(null);
	const ref = useStableCallback((node) => {
		if (node != null) {
			if (instanceRef.current != null) throw new Error("File: An instance should not already exist when a node is created");
			instanceRef.current = new File(options, true);
			instanceRef.current.hydrate({
				file,
				fileContainer: node,
				lineAnnotations
			});
		} else {
			if (instanceRef.current == null) throw new Error("File: A File instance should exist when unmounting");
			instanceRef.current.cleanUp();
			instanceRef.current = null;
		}
	});
	useIsometricEffect(() => {
		if (instanceRef.current == null) return;
		const forceRender = !deepEquals(instanceRef.current.options, options);
		instanceRef.current.setOptions(options);
		instanceRef.current.render({
			file,
			lineAnnotations,
			forceRender
		});
	});
	return ref;
}

//#endregion
export { useFileInstance };
//# sourceMappingURL=useFileInstance.js.map