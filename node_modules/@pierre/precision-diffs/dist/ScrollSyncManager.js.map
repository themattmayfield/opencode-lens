{"version":3,"file":"ScrollSyncManager.js","names":[],"sources":["../src/ScrollSyncManager.ts"],"sourcesContent":["export class ScrollSyncManager {\n  isDeletionsScrolling: boolean = false;\n  isAdditionsScrolling: boolean = false;\n  timeoutId: NodeJS.Timeout = -1 as unknown as NodeJS.Timeout;\n  codeDeletions: HTMLElement | undefined;\n  codeAdditions: HTMLElement | undefined;\n\n  cleanUp(): void {\n    this.codeDeletions?.removeEventListener(\n      'scroll',\n      this.handleDeletionsScroll\n    );\n    this.codeAdditions?.removeEventListener(\n      'scroll',\n      this.handleAdditionsScroll\n    );\n    clearTimeout(this.timeoutId);\n    this.codeDeletions = undefined;\n    this.codeAdditions = undefined;\n  }\n\n  setup(\n    pre: HTMLPreElement,\n    codeDeletions?: HTMLElement,\n    codeAdditions?: HTMLElement\n  ): void {\n    // If no code elements were provided, lets try to find them in\n    // the pre element\n    if (codeDeletions == null || codeAdditions == null) {\n      for (const element of pre.children ?? []) {\n        if (!(element instanceof HTMLElement)) {\n          continue;\n        }\n        if ('deletions' in element.dataset) {\n          codeDeletions = element;\n        } else if ('additions' in element.dataset) {\n          codeAdditions = element;\n        }\n      }\n    }\n    if (codeAdditions == null || codeDeletions == null) {\n      this.cleanUp();\n      return;\n    }\n    this.codeDeletions?.removeEventListener(\n      'scroll',\n      this.handleDeletionsScroll\n    );\n    this.codeAdditions?.removeEventListener(\n      'scroll',\n      this.handleAdditionsScroll\n    );\n    this.codeDeletions = codeDeletions;\n    this.codeAdditions = codeAdditions;\n    codeDeletions.addEventListener('scroll', this.handleDeletionsScroll, {\n      passive: true,\n    });\n    codeAdditions.addEventListener('scroll', this.handleAdditionsScroll, {\n      passive: true,\n    });\n  }\n\n  private handleDeletionsScroll = () => {\n    if (this.isAdditionsScrolling) {\n      return;\n    }\n    this.isDeletionsScrolling = true;\n    clearTimeout(this.timeoutId);\n    this.timeoutId = setTimeout(() => {\n      this.isDeletionsScrolling = false;\n    }, 300);\n    this.codeAdditions?.scrollTo({\n      left: this.codeDeletions?.scrollLeft,\n    });\n  };\n\n  private handleAdditionsScroll = () => {\n    if (this.isDeletionsScrolling) {\n      return;\n    }\n    this.isAdditionsScrolling = true;\n    clearTimeout(this.timeoutId);\n    this.timeoutId = setTimeout(() => {\n      this.isAdditionsScrolling = false;\n    }, 300);\n    this.codeDeletions?.scrollTo({\n      left: this.codeAdditions?.scrollLeft,\n    });\n  };\n}\n"],"mappings":";AAAA,IAAa,oBAAb,MAA+B;CAC7B,uBAAgC;CAChC,uBAAgC;CAChC,YAA4B;CAC5B;CACA;CAEA,UAAgB;AACd,OAAK,eAAe,oBAClB,UACA,KAAK,sBACN;AACD,OAAK,eAAe,oBAClB,UACA,KAAK,sBACN;AACD,eAAa,KAAK,UAAU;AAC5B,OAAK,gBAAgB;AACrB,OAAK,gBAAgB;;CAGvB,MACE,KACA,eACA,eACM;AAGN,MAAI,iBAAiB,QAAQ,iBAAiB,KAC5C,MAAK,MAAM,WAAW,IAAI,YAAY,EAAE,EAAE;AACxC,OAAI,EAAE,mBAAmB,aACvB;AAEF,OAAI,eAAe,QAAQ,QACzB,iBAAgB;YACP,eAAe,QAAQ,QAChC,iBAAgB;;AAItB,MAAI,iBAAiB,QAAQ,iBAAiB,MAAM;AAClD,QAAK,SAAS;AACd;;AAEF,OAAK,eAAe,oBAClB,UACA,KAAK,sBACN;AACD,OAAK,eAAe,oBAClB,UACA,KAAK,sBACN;AACD,OAAK,gBAAgB;AACrB,OAAK,gBAAgB;AACrB,gBAAc,iBAAiB,UAAU,KAAK,uBAAuB,EACnE,SAAS,MACV,CAAC;AACF,gBAAc,iBAAiB,UAAU,KAAK,uBAAuB,EACnE,SAAS,MACV,CAAC;;CAGJ,AAAQ,8BAA8B;AACpC,MAAI,KAAK,qBACP;AAEF,OAAK,uBAAuB;AAC5B,eAAa,KAAK,UAAU;AAC5B,OAAK,YAAY,iBAAiB;AAChC,QAAK,uBAAuB;KAC3B,IAAI;AACP,OAAK,eAAe,SAAS,EAC3B,MAAM,KAAK,eAAe,YAC3B,CAAC;;CAGJ,AAAQ,8BAA8B;AACpC,MAAI,KAAK,qBACP;AAEF,OAAK,uBAAuB;AAC5B,eAAa,KAAK,UAAU;AAC5B,OAAK,YAAY,iBAAiB;AAChC,QAAK,uBAAuB;KAC3B,IAAI;AACP,OAAK,eAAe,SAAS,EAC3B,MAAM,KAAK,eAAe,YAC3B,CAAC"}